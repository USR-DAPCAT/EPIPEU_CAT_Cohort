---
title: "Epipeucat cohorte Longitudinal Retospectiva.Evento DFD."
author: "Jordi Real & Rai Puig"
website: "https://github.com/USR-DAPCAT/"

date: "`r format(Sys.time(), '%d %B, %Y')`"


output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    fig_caption: true
    css: logos_css/usr_styles.css
  pdf_document: default
  word_document: default

params:
  dir_dades_desti: "dades/mostra"
  ANY: '2018'
---

&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logos_css/logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>


<div class="watermark">DRAFT</div>

****

## 0. Estado:

**Ventanas de agregaciones**

&check; INCLUSIO.DM2                [ventana.dias=c(-Inf,0)]   <br/>
&check; DG.(problemas de salud)     [ventana.dias=c(-Inf,0)]   <br/>
&check; GRUP365.UEIP                [ventana.dias=c(-365,0)]   <br/>
&check; Deriv2018.                  [ventana.dias=c(-365,0)]   <br/>
&check; FF.(Farmacos)               [ventana.dias=c(-90,0)]    <br/>
&check; Analitiques+Cliniques       [ventana.dias=c(-365,0)]   <br/>
&check; Tabaquisme                  [ventana.dias=c(-Inf,0)]   <br/>
&check; GRUP.UEIPA                  [ventana.dias=c(-Inf,0)]   <br/>


**Ultimas actualizaciones   Febrero/ 2021** 

&check; Agrupadores para amputaciones y revascularizaciones.  <br/>
&check; Solo 2 grupos con ulcera/pie diabetico ( primaria+hospitales) VS .sin ulcera/pie diabetico (primaria+hospitales). <br/>
&check; Nuevas agregaciones de diagnosticos y farmacos. <br/>
&check; Programacion de nuevas recodificaciones. <br/>
&check; Tabla Descriptiva Exploratoria General, por varlidacion.  <br/>
&check; Descriptiva Exploratoria General.Todas las variables.  <br/>
&check; Tabla UEIP:[Ulceras Extremidades Inferiores y/o Pie Diabetico] /UEIPA:[Ulceras Extremidades Inferiores y/o Pie Diabetico y/o Amputaciones] <br/>
&check; Descriptiva Exploratoria General.BASAL.  <br/>
&check; Descriptiva Exploratoria General.Comorbilidades.  <br/>
&check; Descriptiva Exploratoria General.Antecedentes de Pie diabetico.  <br/>
&check; Descriptiva Exploratoria General.Exploracion.  <br/>
&check; Descriptiva Exploratoria General.Laboratorio.  <br/>
&check; Descriptiva Exploratoria General.Tratamiento.  <br/>
&check; Descriptiva Exploratoria General / UEIPA .  <br/> 
 
 
**Realizado**

&check; Lectura / importacion de archivos.  <br/>
&check; Generacion de conductors.   <br/>
&check; Revision de codigos.  <br/>
&check; Agregacion de datos segun protocolo. <br/>
&check; Calculo de varibles y recodificaciones. <br/>
&check; Descriptiva exploratoria. <br/>
&check; Nuevas agregaciones de diagnosticos y farmacos. <br/>
&check; Programacion de nuevas recodificaciones. <br/>
&check; Descriptiva Exploratoria General.Todas las variables.  <br/>
&check; Tabla UEIP:[Ulceras Extremidades Inferiores y/o Pie Diabetico] /UEIPA:[Ulceras Extremidades Inferiores y/o Pie Diabetico y/o Amputaciones] <br/>
&check; Descriptiva Exploratoria General.BASAL.  <br/>
&check; Descriptiva Exploratoria General.Comorbilidades.  <br/>
&check; Descriptiva Exploratoria General.Antecedentes de Pie diabetico.  <br/>
&check; Descriptiva Exploratoria General.Exploracion.  <br/>
&check; Descriptiva Exploratoria General.Laboratorio.  <br/>
&check; Descriptiva Exploratoria General.Tratamiento.  <br/>
&check; Descriptiva Exploratoria General / UEIPA .  <br/> 

**Pendent**

&check; Revision y depuracion de errores.   <br/>
&check; Modelos multivariables.   <br/>



## Fase Preparacio: cataleg+conductor+link_funcions

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=F,size="huge")
############
#02.11.2020@
############
#

gc()
# libreries i funcions
library("dplyr")
library("lubridate")
library("compareGroups")


link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)

conductor_codis<-here::here("CATALEG_PROYECTO_Manel.xlsx")
conductor<-here::here("conductor_Epipeu.xlsx")




```

```{r llegir, include = FALSE}
# Llegir plana

dades<-readRDS(here::here(params$dir_dades,"dt_plana2.rds")) %>% as_tibble()

```


## Etiquetar_valors_conductor+recodificacions_conductor+missings_conductor+factoritzar.NO.SI
```{r etiquetes}

dades<-dades%>%mutate(exclusio1=ifelse(INCLUSIO.DM2==1,0,1))
dades<-dades%>%mutate(exclusio2=ifelse(age<18,1,0))
dades<-dades%>%mutate(exclusio3=ifelse(dtindex==sortida & situacio!="A",1,0))
dades<-mutate_at(dades, vars( starts_with("exclusio") ), funs( if_else(.==0  | is.na(.)  ,0,1)))

#Recodificar automaticament a partir del Conductor!
dades<-recodificar(dades,taulavariables =conductor,"recode",missings = T)

#Etquetem (Si/No)  a partir del Conductor!
dades<- dades %>% mutate_at(vars(starts_with("DG.")), ~if_else(.==1,"Yes","No",missing = "No")) 
dades<- dades %>% mutate_at(vars(starts_with("EVENT.")), ~if_else(.==1,"Yes","No",missing = "No")) 
dades<- dades %>% mutate_at(vars(starts_with("FF.")), ~if_else(.==1,"Yes","No",missing = "No")) 
dades<- dades %>% mutate_at(vars(starts_with("FP.")), ~if_else(.==1,"Yes","No",missing = "No")) 
#Etquetem (Si/No)  a partir del Conductor!
#dades<-factoritzar.NO.SI(dades,"factor",conductor)

#Etquetem  VALORS! de les VAR  a partir del Conductor!
dades<-etiquetar_valors(dt=dades,variables_factors=conductor,fulla="etiquetes",camp_etiqueta="etiqueta1")


#Apliquem que surtin els MISSINGS a les TAULES , a partir del CONDUCTOR!
dades<-dades%>%mutate_at(extreure.variables("missings",conductor,dt=dades),as.factor)



```

## 1. Flow chart + Etiquetar_Nom_Variables_conductor
```{r Flow chart, include=T}





#13.11.2020

#

flow_chart1<-criteris_exclusio_diagrama(dt=dades,
                                        taulavariables=conductor,
                                        criteris = "exc_pre",
                                        ordre="exc_ordre",
                                        grups=NA,
                                        etiquetes="descripcio",
                                        sequencial = T,
                                        pob_lab=c("epiPEUCAT DM2  ","epiPEUCAT DM2 sin exclusiones"),
                                        colors=c("white","grey"),
                                        forma=c("ellipse","box"))

flow_chart1




#Apliquem les EXCLUSIONS!
dades<-criteris_exclusio(dades,taulavariables=conductor,criteris="exc_pre")


#Etquetem  NOMS! de les  VAR  a partir del Conductor!
dades<-etiquetar(dades,taulavariables=conductor)





```
## 2. Descriptiva Exploratoria General. Todas las variables.


```{r resultats1, include=T}


descrTable(~., dades,method = 2,Q1=0,Q3=1,extra.labels = c("","","")) %>% export2md()



```





```

&nbsp;
<hr />
<p style="text-align: center;">A work by $Jordi Real$ $Rai Puig$ </a></p>
<p style="text-align: center;">$Llepali System$ </a></p>
<p style="text-align: center;"><span style="color: #808080;"><em><https://github.com/USR-DAPCAT/></em></span></p>



