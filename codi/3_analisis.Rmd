---
title: "Epipeucat cohorte Longitudinal Retospectiva.Evento DFD."
author: "Jordi Real & Rai Puig"
website: "https://github.com/USR-DAPCAT/"

date: "`r format(Sys.time(), '%d %B, %Y')`"


output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    fig_caption: true
    css: logos_css/usr_styles.css
  pdf_document: default
  word_document: default

params:
  dir_dades_desti: "dades/mostra"
  ANY: '2018'
---

&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logos_css/logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>


<div class="watermark">DRAFT</div>

****

## 0. Estado:

**Ventanas de agregaciones**

&check; INCLUSIO.DM2                [ventana.dias=c(-Inf,0)]   <br/>
&check; DG.(problemas de salud)     [ventana.dias=c(-Inf,0)]   <br/>
&check; GRUP365.UEIP                [ventana.dias=c(-365,0)]   <br/>
&check; Deriv2018.                  [ventana.dias=c(-365,0)]   <br/>
&check; FF.(Farmacos)               [ventana.dias=c(-90,0)]    <br/>
&check; Analitiques+Cliniques       [ventana.dias=c(-365,0)]   <br/>
&check; Tabaquisme                  [ventana.dias=c(-Inf,0)]   <br/>
&check; GRUP.UEIPA                  [ventana.dias=c(-Inf,0)]   <br/>


**Ultimas actualizaciones   Febrero/ 2021** 

&check; Agrupadores para amputaciones y revascularizaciones.  <br/>
&check; Solo 2 grupos con ulcera/pie diabetico ( primaria+hospitales) VS .sin ulcera/pie diabetico (primaria+hospitales). <br/>
&check; Nuevas agregaciones de diagnosticos y farmacos. <br/>
&check; Programacion de nuevas recodificaciones. <br/>
&check; Tabla Descriptiva Exploratoria General, por varlidacion.  <br/>
&check; Descriptiva Exploratoria General.Todas las variables.  <br/>
&check; Tabla UEIP:[Ulceras Extremidades Inferiores y/o Pie Diabetico] /UEIPA:[Ulceras Extremidades Inferiores y/o Pie Diabetico y/o Amputaciones] <br/>
&check; Descriptiva Exploratoria General.BASAL.  <br/>
&check; Descriptiva Exploratoria General.Comorbilidades.  <br/>
&check; Descriptiva Exploratoria General.Antecedentes de Pie diabetico.  <br/>
&check; Descriptiva Exploratoria General.Exploracion.  <br/>
&check; Descriptiva Exploratoria General.Laboratorio.  <br/>
&check; Descriptiva Exploratoria General.Tratamiento.  <br/>
&check; Descriptiva Exploratoria General / UEIPA .  <br/> 
 
 
**Realizado**

&check; Lectura / importacion de archivos.  <br/>
&check; Generacion de conductors.   <br/>
&check; Revision de codigos.  <br/>
&check; Agregacion de datos segun protocolo. <br/>
&check; Calculo de varibles y recodificaciones. <br/>
&check; Descriptiva exploratoria. <br/>
&check; Nuevas agregaciones de diagnosticos y farmacos. <br/>
&check; Programacion de nuevas recodificaciones. <br/>
&check; Descriptiva Exploratoria General.Todas las variables.  <br/>
&check; Tabla UEIP:[Ulceras Extremidades Inferiores y/o Pie Diabetico] /UEIPA:[Ulceras Extremidades Inferiores y/o Pie Diabetico y/o Amputaciones] <br/>
&check; Descriptiva Exploratoria General.BASAL.  <br/>
&check; Descriptiva Exploratoria General.Comorbilidades.  <br/>
&check; Descriptiva Exploratoria General.Antecedentes de Pie diabetico.  <br/>
&check; Descriptiva Exploratoria General.Exploracion.  <br/>
&check; Descriptiva Exploratoria General.Laboratorio.  <br/>
&check; Descriptiva Exploratoria General.Tratamiento.  <br/>
&check; Descriptiva Exploratoria General / UEIPA .  <br/> 

**Pendent**

&check; Revision y depuracion de errores.   <br/>
&check; Modelos multivariables.   <br/>

# Fase de validacion de base

## Fase Preparacion

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=F,size="huge")
############
#02.11.2020@
############
#

gc()
# libreries i funcions
library("dplyr")
library("lubridate")
library("compareGroups")
#
source(here::here("codi/Flowchart_Box_Final2.r"))
source(here::here("codi/criteris_exclusio_diagrama2.r"))
#
#


link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)

conductor_codis<-here::here("CATALEG_PROYECTO_Manel.xlsx")
conductor<-here::here("conductor_Epipeu.xlsx")




```

```{r llegir, include = FALSE}
# Llegir plana

dades<-readRDS(here::here(params$dir_dades,"dt_plana2.rds")) %>% as_tibble()


#dades<-dades%>%filter(stringr::str_sub(dtindex,1,4)==params$ANY)


```


## Etiquetar
```{r etiquetes}






#Recodificar automaticament a partir del Conductor!
#dt_plana<-recodificar(dt_plana,taulavariables =conductor,"recode",missings = T)

#Etquetem (Si/No)  a partir del Conductor!
dades<-factoritzar.NO.SI(dades,"factor",conductor)

# FF.Hipotensores_ARA\r\n    FF.Hipotensores_IECA \r\n   FF.Hipolipemiantes_FIB\r\n   FF.Hipolipemiantes_EZE\r\n 

#Etquetem  VALORS! de les VAR  a partir del Conductor!
dades<-etiquetar_valors(dt=dades,variables_factors=conductor,fulla="etiquetes",camp_etiqueta="etiqueta1")




```

## 1. Flow chart 
```{r Flow chart, include=T}





#13.11.2020

#

flow_chart1<-criteris_exclusio_diagrama(dt=dades,
                                        taulavariables=conductor,
                                        criteris = "exc_pre",
                                        ordre="exc_ordre",
                                        grups=NA,
                                        etiquetes="descripcio",
                                        sequencial = T,
                                        pob_lab=c("epiPEUCAT DM2  ","epiPEUCAT DM2 sin exclusiones"),
                                        colors=c("white","grey"),
                                        forma=c("ellipse","box"))

flow_chart1


#flow_chart2<-criteris_exclusio_diagrama2(dt=dt_plana,
#                                         taulavariables=conductor,
#                                         criteris = "exc_pre",
#                                         ordre="exc_ordre",
#                                         grups=NA,
#                                      etiquetes="descripcio",
#                                         sequencial = T,
#                                         pob_lab=c("Muestra epiPEUCAT DM2 ","Muestra epiPEUCAT DM2 sin exclusiones"),
#                                         colors=c("white","grey"),
#                                         POB=459331 ,
#                                         POB_LAB="SIDIAP:La poblacion de pacientes con DM2 de 2017 aprox: ")


#flow_chart2


#Apliquem les EXCLUSIONS!
dades<-criteris_exclusio(dades,taulavariables=conductor,criteris="exc_pre")


#Apliquem que surtin els MISSINGS a les TAULES , a partir del CONDUCTOR!
dades<-dades%>%mutate_at(extreure.variables("missings",conductor,dt=dades),as.factor)

#Etquetem  NOMS! de les  VAR  a partir del Conductor!
dades<-etiquetar(dades,taulavariables=conductor)





```
## 2. Descriptiva Exploratoria General. Todas las variables.
```{r resultats0, include=T}

#i)
#formula_Taula00<-formula.text("Taula00",y="",taulavariables = conductor,dt=dt_plana_exc)


```

```{r resultats1, include=T}

#Part1
#i)
#descrTable(formula_Taula00,
#           method =2,
#           Q1 = 0, 
#           Q3 = 1,
#           data=dt_plana_exc,
#           include.miss = TRUE,
#           max.xlev = 200, 
#           show.p.overall=FALSE,
#           show.n = T,
#          hide.no="No",simplify=F)%>%export2md(header.background = "grey", header.color = "white", size=12,caption = "Descriptiva GENERAL 1 :[Frecuencia,Mediana,Min,Max]")
#
#



descrTable(~., dades,method = 2,Q1=0,Q3=1,extra.labels = c("","","")) %>% export2md()



```





```

&nbsp;
<hr />
<p style="text-align: center;">A work by $Jordi Real$ $Rai Puig$ </a></p>
<p style="text-align: center;">$Llepali System$ </a></p>
<p style="text-align: center;"><span style="color: #808080;"><em><https://github.com/USR-DAPCAT/></em></span></p>



